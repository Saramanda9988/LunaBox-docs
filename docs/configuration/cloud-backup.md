# 云配置备份

LunaBox 支持将您的游戏存档和应用数据库备份到云端，确保数据的安全。目前支持 S3 兼容的存储服务和 OneDrive。

## 核心概念

### 备份密码与用户标识 (User ID)

为了保护您的隐私，LunaBox 在上传数据前会使用您设置的**备份密码**对数据进行加密。
同时，系统会根据您的备份密码生成一个唯一的 **User ID** (`backup_user_id`)。

- **备份密码 (`BackupPassword`)**: 用于加密备份文件。**请务必牢记此密码**，如果没有密码，您将无法恢复云端的备份数据。
- **User ID (`BackupUserID`)**: 用于在云存储中区分不同用户的数据。它是根据备份密码生成的哈希值。

### 自动备份策略

您可以在设置中自定义备份的触发时机：

- **退出时自动备份数据库 (`AutoBackupDB`)**: 当关闭 LunaBox应用时，自动创建数据库的备份。
- **游戏退出时自动备份存档 (`AutoBackupGameSave`)**: 当您结束某个游戏的游玩（关闭游戏窗口）时，自动检测并备份该游戏的存档文件。
- **自动上传备份到云端 (`AutoUploadToCloud`)**: 当本地生成了新的备份（无论是数据库还是游戏存档）时，自动将其上传到配置的云存储中。

### 备份保留策略

为了节省存储空间，LunaBox 提供了本地和云端的备份保留策略设置：

- **本地游戏备份保留数量 (`LocalBackupRetention`)**: 本地保留的最近游戏存档备份数量（默认 10）。
- **本地数据库备份保留数量 (`LocalDBBackupRetention`)**: 本地保留的最近数据库备份数量（默认 5）。
- **云端保留备份数量 (`CloudBackupRetention`)**: 云端保留的最近备份数量（默认 5）。

超过保留数量的旧备份将被自动删除。

## 如何启用

1. 进入 **设置 (Settings)** 页面。
2. 找到 **云备份 (Cloud Backup)** 部分。
3. 开启 **启用云备份** 开关。
4. 设置 **备份密码**。
5. 选择您的 **云备份提供商** (S3 或 OneDrive)。
6. 根据所选提供商配置相应的连接信息（详见下方文档）。

## 支持的云服务

- [S3 兼容存储](./s3-cloud-backup.md) (AWS S3, MinIO, 阿里云 OSS, 七牛云等)
- [OneDrive](./onedrive-cloud-backup.md)
